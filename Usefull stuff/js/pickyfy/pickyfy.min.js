!function(e){e.fn.pickyfy=function(t,i){var n,a=e.extend({allowDuplicate:!1,width:"100%"},t);if(t&&"string"==typeof t){if("getData"==t)return o(this.selector);if("setData"==t)return function(t,i){for(var n in(l=e(t).next(".chosen-container")).find(".search-choice").remove(),i){var a='<li class="search-choice"  data-option-id="'+i[n].id+'" style="position: relative; left: 0px; top: 0px;"><span>'+i[n].text+'</span><a class="search-choice-close"></a></li>';l.find("li.search-field").before(a)}return}(this.selector,i);if("clearData"==t)return n=this.selector,void(l=e(n).next(".chosen-container")).find(".search-choice").remove()}function o(t){var i=[],n=(l=e(t).next(".chosen-container")).find(".search-choice");return e(n).each(function(){i.push({id:e(this).attr("data-option-id"),text:e(this).children("span").text()})}),i}var s=this.selector,r='<div class="chosen-container chosen-container-multi" title="" style="width:'+a.width+' ;"><ul class="chosen-choices ui-sortable"><li class="search-field"><input class="chosen-search-input" autocomplete="off" style="width: 50px;"  type="text"></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div></div>';e(r).insertAfter(e(s));var c="";e(s+" option").each(function(){var t,i,n,a="",o="";n=e(this).text(),t=e(this).val(),e(this).parent("optgroup").length>0&&(o='<li class="group-result">'+(a=e(this).parent("optgroup").attr("label"))+"</li>",c!=a&&(e(s).next(".chosen-container").find(".chosen-results").append(o),c=a)),i='<li class="group-option active-result" data-option-id="'+t+'" >'+n+"</li>",e(s).next(".chosen-container").find(".chosen-results").append(i)});var l=e(s).next(".chosen-container"),h=l.find(".chosen-results li.active-result"),d=l.find(".chosen-drop"),p=(d.find(".chosen-results"),l.find(".search-choice-close")),u=l.find(".chosen-search-input");function f(t){if((t=e.trim(t),!a.allowDuplicate)&&o(s).map(function(e){return e.text.toLowerCase()}).indexOf(t.toLowerCase())>-1)return l.find(".search-choice").filter(function(i,n){e(n).text().toLowerCase()==t.toLowerCase()&&e(this).addClass("duplicateTag").delay(1e3).queue(function(){e(this).removeClass("duplicateTag"),e(this).dequeue()})}),!1;return!0}function v(t){if(8===t.which&&0==t.target.value.length){var i=u.parent("li").prev("li.search-choice").attr("data-option-id"),n=u.parent("li").prev("li.search-choice").attr("data-custom-tag");u.parent("li").prev("li.search-choice").remove(),"true"==n?e(s).find("option[value='"+i+"']").remove():e(s).find("option[value='"+i+"']").removeAttr("selected")}}function g(t){e(t.target).parent().parent().parent().find(".chosen-drop").hide();var i=t.target.value.toLowerCase();i.length>0?(e(h).each(function(){-1==e(this).html().toLowerCase().indexOf(i)?e(this).hide():e(this).show()}),e(t.target).parent().parent().parent().find(".chosen-drop").show()):(e(h).show(),e(t.target).parent().parent().parent().find(".chosen-drop").show())}function m(t){if(13===t.which&&u.val().length>0&&""!=e.trim(u.val())&&f(u.val())){var i=parseInt(e(s).find("option:last").attr("value"))+1,n='<li class="search-choice" data-custom-tag="true" data-option-id="'+i+'" style="position: relative; left: 0px; top: 0px;"><span>'+u.val()+'</span><a class="search-choice-close"></a></li>';e(s).find("option[value='"+u.val()+"']").length>0&&0==l.find(".search-choice").length&&e(s).find("option[value='"+u.val()+"']").remove(),e(s).append("<option value='"+i+"'>"+u.val()+"</option>"),e(s).find("option[value='"+i+"']").prop("selected","selected"),l.find("li.search-field").before(n),u.val(""),d.hide()}}e(s).next(".chosen-container").find("ul.chosen-choices").sortable({containment:"parent",update:function(){var t=e(this).find("li.search-field");e(this).find("li.search-field").remove(),e(t).appendTo(e(this)),u.keypress(function(e){m(e)}),u.keyup(function(e){g(e)}),u.keydown(function(e){v(e)})}}),h.hover(function(){e(this).addClass("highlighted")},function(){e(this).removeClass("highlighted")}),l.click(function(){e(this).find("ul.chosen-results  li.active-result").show(),d.show(),u.focus()}),e("html").click(function(){d.hide()}),h.click(function(){var t=e.trim(e(this).text()),i=e.trim(this.attr("data-option-id"));if(""!=t&&f(t)){var n='<li class="search-choice" data-option-id="'+i+'" style="position: relative; left: 0px; top: 0px;"><span>'+t+'</span><a class="search-choice-close"></a></li>';l.find("li.search-field").before(n);var a=o(s);for(var r in a){var c=a[r].id;e(s).find("option[value='"+c+"']").prop("selected","selected")}}}),e(document).on("click",p,function(){var t=e(this).parent("li").attr("data-option-id");e(this).parent("li").remove(),e(s).find("option[value='"+t+"']").removeAttr("selected")}),l.click(function(t){if(e(t.target).hasClass("search-choice-close")){var i=e(t.target).parent("li").attr("data-option-id"),n=e(t.target).parent("li").attr("data-custom-tag");e(t.target).parent("li").remove(),"true"==n?e(s).find("option[value='"+i+"']").remove():e(s).find("option[value='"+i+"']").removeAttr("selected")}e(t.target).hasClass("active-result")&&d.hide(),d.parent().find("div.chosen-drop").is(":visible")&&e(".chosen-drop").not(d).hide(),t.stopPropagation()}),d.click(function(t){e(t.target).hasClass("active-result")&&d.hide(),t.stopPropagation()}),u.keypress(function(e){m(e)}),u.keyup(function(e){g(e)}),u.keydown(function(e){v(e)})}}(jQuery);